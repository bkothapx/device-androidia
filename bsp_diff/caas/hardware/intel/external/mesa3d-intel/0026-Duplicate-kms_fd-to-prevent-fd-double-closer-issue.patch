From efa858c9d6619c84342891a7d941a895a970ec78 Mon Sep 17 00:00:00 2001
From: gollarx <ratnakumarix.golla@intel.com>
Date: Fri, 15 Jul 2022 14:10:01 +0530
Subject: [PATCH] Duplicate kms_fd to prevent fd double closer issue

Tracked-On: OAM-102839
Signed-of-by: Shekhar Chauhan <shekhar.chauhan@intel.com>
---
 src/gallium/winsys/iris/drm/iris_drm_winsys.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/gallium/winsys/iris/drm/iris_drm_winsys.c b/src/gallium/winsys/iris/drm/iris_drm_winsys.c
index a941ad0b511..7006efaf89a 100644
--- a/src/gallium/winsys/iris/drm/iris_drm_winsys.c
+++ b/src/gallium/winsys/iris/drm/iris_drm_winsys.c
@@ -53,7 +53,7 @@ iris_screen_create_renderonly(struct renderonly *ro,
       return NULL;
 
    pscreen->ro = ro;
-   pscreen->winsys_fd = ro->kms_fd;
+   pscreen->winsys_fd = os_dupfd_cloexec(ro->kms_fd);
 
    return &pscreen->base;
-}
\ No newline at end of file
+}
-- 
2.17.1

