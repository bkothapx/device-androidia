From 114c2126b6fe096105d04b25d7327b5aaff699c8 Mon Sep 17 00:00:00 2001
From: Zhuo Peng <zhuo.peng@intel.com>
Date: Wed, 26 Aug 2020 20:47:43 +0800
Subject: [PATCH] Modify --auto-start to include sub-parameter

Change-Id: Ia56e879e2358ab25eed324c596fd2e6ee747122d
Signed-off-by: Zhuo Peng <zhuo.peng@intel.com>
Tracked-On: OAM-92624

diff --git a/scripts/setup_host.sh b/scripts/setup_host.sh
index 67796a9..9bf7b1e 100755
--- a/scripts/setup_host.sh
+++ b/scripts/setup_host.sh
@@ -176,8 +176,10 @@ function install_auto_start_service(){
     echo -e "Description=CiV Auto Start\n" >> $service_file

     echo "[Service]" >> $service_file
+    echo -e "Type=forking\n" >> $service_file
+    echo -e "TimeoutSec=infinity\n" >> $service_file
     echo -e "WorkingDirectory=$CIV_WORK_DIR\n" >> $service_file
-    echo -e "ExecStart=/bin/bash -E $CIV_WORK_DIR/scripts/start_civ.sh\n" >> $service_file
+    echo -e "ExecStart=/bin/bash -E $CIV_WORK_DIR/scripts/start_civ.sh $1\n" >> $service_file

     echo "[Install]" >> $service_file
     echo -e "WantedBy=multi-user.target\n" >> $service_file
@@ -283,7 +285,8 @@ function parse_arg() {
                 ;;

             --auto-start)
-                install_auto_start_service || return -1
+                install_auto_start_service "$2" || return -1
+                shift
                 ;;

             -?*)
--
2.17.1

