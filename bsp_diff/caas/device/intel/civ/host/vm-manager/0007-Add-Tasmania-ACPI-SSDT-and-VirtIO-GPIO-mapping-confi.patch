From 3c93ebf773c8ebf26bb4de7ef2681358cabe7ef1 Mon Sep 17 00:00:00 2001
From: Colin Xu <colin.xu@intel.com>
Date: Fri, 28 Aug 2020 13:16:02 +0800
Subject: [PATCH 4/4] Add Tasmania ACPI SSDT and VirtIO GPIO mapping config

Change-Id: I059292d6142c97877d922edd12b3c34db5cfad20
Tracked-On: OAM-92391
Signed-off-by: Colin Xu <colin.xu@intel.com>
---
 skucfg/tasmania/ssdt.dsl        | 79 +++++++++++++++++++++++++++++++++
 skucfg/tasmania/virtio_gpio.map |  4 ++
 2 files changed, 83 insertions(+)
 create mode 100644 skucfg/tasmania/ssdt.dsl
 create mode 100644 skucfg/tasmania/virtio_gpio.map

diff --git a/skucfg/tasmania/ssdt.dsl b/skucfg/tasmania/ssdt.dsl
new file mode 100644
index 000000000000..dbc0b1eb2e4a
--- /dev/null
+++ b/skucfg/tasmania/ssdt.dsl
@@ -0,0 +1,79 @@
+/* QEMU will only user data portion, all header information is specified in the command line */
+DefinitionBlock (
+    "ssdt.aml",
+    "SSDT",
+    0x00000001,
+    "INTEL",
+    "INTLSSDT",
+    0x00000001
+    )
+{
+    External (_SB_.PCI0, DeviceObj)
+    Scope (_SB.PCI0) {
+        Device (GPI0) {
+            Name (LINK, "\\_SB.PCI0.GPI0")
+            /* Match VirtoIO GPIO PCI in guest */
+            Name (_ADR, 0x00140000)
+            Name (_DDN, "VirtoIO GPIO Controller")
+            Name (_UID, "VirtoIO GPIO Controller 0")
+            /* Empty _CRS, VirtoIO GPIO FE will handle all PV resource */
+            Method (_CRS, 0, Serialized) {
+                Return (Buffer(Zero){})
+            }
+            Method (_STA, 0, NotSerialized) {
+                Return (0x0F)
+            }
+        }
+
+        Device (I2C1) {
+            Name (_ADR, 0x00150001)
+            Device (NFC1) {
+                Name (_ADR, Zero)  // _ADR: Address
+                Name (_HID, EisaId ("NXP1002"))  // _HID: Hardware ID
+                Name (_CID, "NXP1002")  // _CID: Compatible ID
+                Name (_DDN, "NXP NFC")  // _DDN: DOS Device Name
+                Name (_UID, One)  // _UID: Unique ID
+                Method (_STA, 0, NotSerialized) {
+                    Return (0x0F)
+                }
+                Method (_CRS, 0, Serialized) {
+                    Name (SBUF, ResourceTemplate () {
+                        I2cSerialBusV2 (0x0029, ControllerInitiated, 0x00061A80,
+                            AddressingMode7Bit, "\\_SB.PCI0.I2C1",
+                            0x00, ResourceConsumer, _Y55, Exclusive,
+                            )
+                        GpioInt (Edge, ActiveHigh, ExclusiveAndWake, PullDefault, 0x0000,
+                            "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
+                            )
+                            {
+                                0x0001
+                            }
+                        GpioIo (Exclusive, PullDefault, 0x0000, 0x0000, IoRestrictionOutputOnly,
+                            "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
+                            )
+                            {
+                                0x0002
+                            }
+                        GpioIo (Exclusive, PullDefault, 0x0000, 0x0000, IoRestrictionOutputOnly,
+                            "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
+                            )
+                            {
+                                0x0003
+                            }
+                    })
+                    CreateWordField (SBUF, \_SB.PCI0.I2C1.NFC1._CRS._Y55._ADR, NADR)
+                    CreateDWordField (SBUF, \_SB.PCI0.I2C1.NFC1._CRS._Y55._SPE, NSPD)
+                    //CreateWordField (SBUF, 0x38, NFCA)
+                    //CreateWordField (SBUF, 0x60, NFCB)
+                    //CreateWordField (SBUF, 0x88, NFCC)
+                    NADR = 0x29
+                    NSPD = 0x00061A80
+                    //NFCA = 0x0000
+                    //NFCB = 0x0001
+                    //NFCC = 0x0002
+                    Return (SBUF)
+                }
+            }
+        }
+    }
+}
diff --git a/skucfg/tasmania/virtio_gpio.map b/skucfg/tasmania/virtio_gpio.map
new file mode 100644
index 000000000000..e5e56f88d53d
--- /dev/null
+++ b/skucfg/tasmania/virtio_gpio.map
@@ -0,0 +1,4 @@
+# devfn in guest, must match DSDT/SSDT
+0x14.0
+# pin mapping json for virtio-gpio-pci
+{"base":0,,"map":[{"chip":"gpiochip0",, "pin":0,,"bypass":true},,{"chip":"gpiochip0",, "pin":257},,{"chip":"gpiochip0",, "pin":192},,{"chip":"gpiochip0",, "pin":86}]}
\ No newline at end of file
-- 
2.28.0

