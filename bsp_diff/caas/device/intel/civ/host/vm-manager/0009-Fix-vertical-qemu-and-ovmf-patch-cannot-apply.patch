From e070801aecea23fbe752de75c25a80aa56f6f13a Mon Sep 17 00:00:00 2001
From: Zhuo Peng <zhuopeng@intel.com>
Date: Fri, 18 Sep 2020 18:32:10 +0800
Subject: [PATCH] Fix vertical quemu and ovmf patch cannot apply

Change-Id: I45a6d093ca383ef2a8b22ec0bed358ad687b48dc
Signed-off-by: Zhuo Peng <zhuopeng@intel.com>
Tracked-On: OAM-92973

diff --git a/scripts/setup_host.sh b/scripts/setup_host.sh
index 3c3376a..5d514b3 100755
--- a/scripts/setup_host.sh
+++ b/scripts/setup_host.sh
@@ -47,10 +47,12 @@ function ubu_install_qemu_gvt(){
         for i in $CIV_GOP_DIR/qemu/*.patch; do patch -p1 < $i; done
     fi

-    if [ -f $CIV_VERTICAl_DIR/qemu/*.patch ]; then
-	for i in $CIV_VERTICAl_DIR/qemu/*.patch; do
-        echo "applying qemu patch $i";
-        patch -p1 < $i; done
+    vertical_qemu_patch_num=$(ls $CIV_VERTICAl_DIR/qemu/*.patch 2> /dev/null | wc -l)
+    if [ "$vertical_qemu_patch_num" != "0" ]; then
+        for i in $CIV_VERTICAl_DIR/qemu/*.patch; do
+            echo "applying qemu patch $i"
+            patch -p1 < $i
+        done
     fi

     ./configure --prefix=/usr \
@@ -83,10 +85,12 @@ function ubu_build_ovmf_gvt(){
         cp $CIV_GOP_DIR/ovmf/Vbt.bin OvmfPkg/Vbt/Vbt.bin
     fi

-    if [ -f $CIV_VERTICAl_DIR/ovmf/*.patch ]; then
+    vertical_ovmf_patch_num=$(ls $CIV_VERTICAl_DIR/ovmf/*.patch 2> /dev/null | wc -l)
+    if [ "$vertical_ovmf_patch_num" != "0" ]; then
         for i in $CIV_VERTICAl_DIR/ovmf/*.patch; do
-                echo "applying ovmf patch $i";
-                patch -p1 < $i; done
+            echo "applying ovmf patch $i"
+            patch -p1 < $i
+        done
     fi

     source ./edksetup.sh
--
2.17.1

