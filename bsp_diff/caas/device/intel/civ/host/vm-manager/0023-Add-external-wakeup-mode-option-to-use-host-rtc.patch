From 1262fc53d604822ba7299446812b6639ef458ff8 Mon Sep 17 00:00:00 2001
From: Zhuo Peng <zhuo.peng@intel.com>
Date: Tue, 19 Jan 2021 17:10:23 +0800
Subject: [PATCH] Add '--external-wakeup-mode' option to use host rtc

Change-Id: I1052bcc26430f30f61fe742c6db651c1b656be90
Tracked-On: OAM-95482
Signed-off-by: Zhuo Peng <zhuo.peng@intel.com>
---
 scripts/start_civ.sh | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/scripts/start_civ.sh b/scripts/start_civ.sh
index 4526a1f..50f8e89 100755
--- a/scripts/start_civ.sh
+++ b/scripts/start_civ.sh
@@ -58,6 +58,7 @@ GUEST_AAF_CONFIG=$GUEST_AAF_DIR/mixins.spec
 GUEST_POWER_BUTTON=
 GUEST_GRAPHIC_MODE=
 GUEST_WMI_DEV=
+GUEST_EXTERNAL_WAKEUP=
 GUEST_USB_XHCI_OPT="\
  -device qemu-xhci,id=xhci,p2=8,p3=8 \
  -usb \
@@ -769,6 +770,10 @@ function set_guest_pwr_vol_button() {
     cd -
 }
 
+function enable_external_wakeup_mode() {
+    GUEST_EXTERNAL_WAKEUP='-global mc146818rtc.external_wakeup=on'
+}
+
 function cleanup() {
     cleanup_rpmb_dev
     cleanup_thermal_mediation
@@ -813,6 +818,7 @@ function launch_guest() {
               $GUEST_UDC_PT_DEV \
               $GUEST_AUDIO_PT_DEV \
               $GUEST_ETH_PT_DEV \
+              $GUEST_EXTERNAL_WAKEUP \
               $GUEST_WIFI_PT_DEV \
               $GUEST_ACPI_SSDT \
               $GUEST_I2C_PT_DEV \
@@ -993,6 +999,10 @@ function parse_arg() {
                 set_guest_time_keep
                 ;;
 
+            --external-wakeup-mode)
+                enable_external_wakeup_mode
+                ;;
+
             --allow-suspend)
                 allow_guest_suspend
                 ;;
-- 
2.17.1

