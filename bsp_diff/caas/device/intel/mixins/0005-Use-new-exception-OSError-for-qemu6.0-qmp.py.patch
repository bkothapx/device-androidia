From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Zhuo Peng <zhuo.peng@intel.com>
Date: Mon, 8 Nov 2021 20:44:16 +0800
Subject: [PATCH] Use new exception OSError for qemu6.0 qmp.py

Instead of qemu.error, qemu6.0's qmp.py file raises
OSError on socket connection errors. This exception
need to be handled.

Signed-off-by: Zhuo Peng <zhuo.peng@intel.com>
---
 groups/device-specific/caas/guest_pm_control | 6 +++---
 groups/device-specific/caas/wakeup.py        | 5 +++--
 2 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/groups/device-specific/caas/guest_pm_control b/groups/device-specific/caas/guest_pm_control
index ce151e3..c57f675 100755
--- a/groups/device-specific/caas/guest_pm_control
+++ b/groups/device-specific/caas/guest_pm_control
@@ -21,7 +21,7 @@ import glob
 import subprocess
 from sys import argv,exit
 
-sys.path.append(os.path.join(os.path.dirname(__file__), '../qemu-4.2.0/python'))
+sys.path.append(os.path.join(os.path.dirname(__file__), '../qemu-6.0.0/python'))
 from qemu import qmp
 
 rtc_wakeup = 0
@@ -79,10 +79,10 @@ def main():
             print('Didn\'t get QMP greeting message from QEMU QMP server')
         except qmp.QMPCapabilitiesError:
             print('Could not negotiate capabilities with QEMU QMP server')
-        except qemu.error:
-            print
         except qmp.QMPTimeoutError:
             print('Connection Timeout Error')
+        except OSError:
+            print
         else:
             print("connected to QEMU QMP server")
             break
diff --git a/groups/device-specific/caas/wakeup.py b/groups/device-specific/caas/wakeup.py
index 7edc528..fef0b03 100755
--- a/groups/device-specific/caas/wakeup.py
+++ b/groups/device-specific/caas/wakeup.py
@@ -8,7 +8,7 @@ from sys import argv,exit
 
 timeout = 60
 
-sys.path.append(os.path.join(os.path.dirname(__file__), '../qemu-4.2.0/python'))
+sys.path.append(os.path.join(os.path.dirname(__file__), '../qemu-6.0.0/python'))
 
 from qemu import qmp
 
@@ -23,12 +23,13 @@ def main():
             print('Didn\'t get QMP greeting message from QEMU QMP server')
         except qmp.QMPCapabilitiesError:
             print('Could not negotiate capabilities with QEMU QMP server')
-        except qemu.error:
+        except OSError:
             print
 
         if time.time() >= timeout + timeout_start:
             print("connection timeout error")
             return
+
     resp = qemu.cmd('query-status')
     if resp != None:
         for val in resp.values():
-- 
2.17.1

